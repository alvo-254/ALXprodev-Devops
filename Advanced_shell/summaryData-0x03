#!/bin/bash
# Task 3 - Generate CSV report and averages from multiple PokÃ©mon JSON files

input_dir="pokemon_data"
report_file="pokemon_report.csv"

# Write CSV header
echo "Name,Height (m),Weight (kg)" > "$report_file"

# Loop through all JSON files and extract data
for file in "$input_dir"/*.json; do
    name=$(jq -r '.name' "$file" | sed 's/.*/\u&/')
    height=$(jq -r '.height' "$file")
    weight=$(jq -r '.weight' "$file")

    formatted_height=$(awk "BEGIN {printf \"%.1f\", $height/10}")
    formatted_weight=$(awk "BEGIN {printf \"%.1f\", $weight/10}")

    echo "$name,$formatted_height,$formatted_weight" >> "$report_file"
done

# Calculate averages
avg_height=$(awk -F, 'NR>1 {sum+=$2; count++} END {printf "%.2f", sum/count}' "$report_file")
avg_weight=$(awk -F, 'NR>1 {sum+=$3; count++} END {printf "%.2f", sum/count}' "$report_file")

echo "CSV Report generated at: $report_file"
echo
cat "$report_file"
echo
echo "Average Height: ${avg_height} m"
echo "Average Weight: ${avg_weight} kg"
